# Решение кейса 12 Сбер "Предиктивная модель для рекомендации продукта банка" команды Мисисково

## Общая структура решения:

### Модули:
- AggFeatureSeqEncoder: Создание агрегированных признаков для транзакций и гео.
- custom_CoLES: Реализация для masked CoLes, CoLES + time features, CoLES + AR. Включает в себя модуль pandas_preprocessor.py - улучшенная и оптимизированная версия PandasDataPreprocessor из pytorch-lifestream.
- dialog_embs: Модуль для агрегации эмбеддингов диалогов по клиентам и месяцам.
- downstream_models: Различные downstream модели для объединения модальностей и предсказания по тесту.
- aggregation_model: Построение аггрегационных признаков с помощью pivot_tables.

## Эксперименты:
1. custom CoLES: masked CoLES - маскирует рандомные транзакции и пытается их восстановить.
2. CoLES + AR - предсказывает следующую транзакцию.
3. AggFeatureSeqEncoder + CoLES - аггрегированные признаки объединяются с эмбеддингами от CoLES.
4. Использование pivot_tables для получения отдельных агрегированных признаков.
5. Обработка диалоговых эмбеддингов - агрегирование по пользователям и месяцам (среднее, сумма, стандартное отклонение, медиана).
6. Обучение на истории для пользователей из теста и трейна.
7. Запуск LightAutoML совместно с бустингами для предсказания таргетов.

## Валидация:
- Разработан уникальный алгоритм валидации, названный Holdout валидация.
- Использование истории теста для валидации.
- При добавлении истории теста в трейн, используется последний месяц для каждого клиента.

## Результаты:
- mean_target: 0.82
- target_1: 0.72
- target_2: 0.85
- target_3: 0.77
- target_4: 0.87
- Лучший скор на публичном лидерборде: 0.81994

Лучшие результаты показала модель, объединяющая все три модальности, использующая средние эмбеддинги диалогов. Потенциально лучшее решение включало 2000 признаков, полученных из истории для train и test.